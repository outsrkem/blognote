{% extends 'base.html' %}
{% block base %}
    <!-- 引入编辑器配置文件 -->
    <script type="text/javascript" src="/ueditor-utf8/ueditor.config.js" xmlns="http://www.w3.org/1999/html"></script>
    <script type="text/javascript" src="/ueditor-utf8/ueditor.all.js"></script>
    <script type="text/javascript" src="/ueditor-utf8/lang/zh-cn/zh-cn.js"></script>
    <!-- 实例化编辑器 -->
    <script type="text/javascript">
        var ue = UE.getEditor('content', {
            initialFrameHeight: 400,
            autoHeightEnabled: true,
            autoFloatEnabled: false,
            elementPathEnabled: false,
            wordCount: true,
            serverUrl: '/uedit'

        });
    </script>
    <!-- 实例化编辑器结束 -->

    <!--文本编辑框-->
    <div class="container" style="margin-top: 20px; background-color: white; padding: 20px">
        <div class="row form-group">
            <label for="headline" class="col-1">文章标题</label>
            <input type="text" class="col-11" id="headline"/>
        </div>
        <div class="row">
            <script id="content" name="content" type="text/plain">
            </script>
        </div>
        <div class="row form-group" style="margin-top: 20px;padding-top: 10px;">
            <label for="type" class="col-1">类型：</label>
            <select class="form-control col-2" id="type">
                <option value="1">PHP开发</option>
                <option value="2">java开发</option>
                <option value="3">Python开发</option>
                <option value="4">Web前端</option>
                <option value="5">测试开发</option>
                <option value="6">数据科学</option>
                <option value="7">网络安全</option>
                <option value="8">蜗牛杂谈</option>
            </select>
            <label class="col-1"></label>
            <label for="type" class="col-1">积分：</label>
            <select class="form-control col-2" id="credit">
                <option value="0">免费</option>
                <option value="1">1分</option>
                <option value="2">2分</option>
                <option value="5">5分</option>
                <option value="10">10分</option>
                <option value="20">20分</option>
                <option value="50">50分</option>
            </select>
            <label class="col-1"></label><label class="col-1"></label>
            <button class="form-control btn-default col-1" onclick="doDraft()">保存草稿</button>
            <button class="form-control btn-primary col-1" onclick="doPost()">发布文章</button>

        </div>
    </div>
    <!--文本编辑框结束-->
    <script>
        function doPost() {
            var headline = $.trim($('#headline').val());
            var contentPlain = UE.getEditor("content").getContentTxt();

            if (headline.length < 5) {
                bootbox.alert({title: "错误提示", message: "标题不能少于5个字"});
                return false;
            } else if (contentPlain.length < 100) {
                bootbox.alert({title: "错误提示", message: "内容不能少于100个字"});
                return false;
            }
            var param = "headline=" + headline;
                param += "&content="+encodeURIComponent(UE.getEditor("content").getContent());
                param += "&type=" + $("#type").val();
                param += "&credit=" + $("#credit").val();
                param += "&drafted=0&checked=1";
            $.post('/article',param,function (data) {
                if (data == 'perm-denied'){
                    bootbox.alert({title: "错误提示", message: "权限不足"});
                }
                if (data == 'post-fail'){
                    bootbox.alert({title: "错误提示", message: "发布失败"});
                }
                if (data.match(/^\d+$/)){
                    bootbox.alert({title: "信息提示", message: "发布成功"});
                    setTimeout(function () {
                        location.href = '/article/' + data;
                    },1000);
                }
                else {
                   bootbox.alert({title: "错误提示", message: "发布失败，可能没有权限"});
                }
            })

        }
    </script>
{% endblock base %}
